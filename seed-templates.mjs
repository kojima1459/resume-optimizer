import { drizzle } from "drizzle-orm/mysql2";
import mysql from "mysql2/promise";

const DATABASE_URL = process.env.DATABASE_URL;

if (!DATABASE_URL) {
  console.error("DATABASE_URL is not set");
  process.exit(1);
}

const connection = await mysql.createConnection(DATABASE_URL);
const db = drizzle(connection);

console.log("Seeding template data...");

const templates = [
  // IT業界 - エンジニア
  {
    category: "IT",
    jobType: "engineer",
    name: "ITエンジニア向けテンプレート",
    description: "ソフトウェアエンジニア、Webエンジニア、インフラエンジニアなどIT技術職向けのテンプレートです。技術スキルと実績を重視した構成になっています。",
    promptTemplate: `あなたはIT業界に精通した職務経歴書作成の専門家です。以下の点を重視して、技術職向けの職務経歴書を作成してください：

1. **技術スキルの明確化**: 使用技術、プログラミング言語、フレームワーク、ツールを具体的に記載
2. **定量的な成果**: パフォーマンス改善率、処理速度向上、バグ削減率などの数値を含める
3. **問題解決能力**: 技術的な課題をどのように解決したかを具体的に説明
4. **チーム開発経験**: アジャイル開発、コードレビュー、技術選定などの経験を強調
5. **継続的な学習姿勢**: 新技術へのキャッチアップ、OSS貢献、技術ブログなどをアピール

職務経歴書: {{resumeText}}
求人情報: {{jobDescription}}`,
    sampleContent: JSON.stringify({
      summary: "5年以上のWebアプリケーション開発経験を持つフルスタックエンジニア。React/Node.jsを用いた大規模SaaS開発において、パフォーマンス最適化により応答速度を40%改善。アジャイル開発チームのテックリードとして、コードレビュー文化の定着とCI/CD環境の構築を主導。",
      motivation: "貴社が提供するクラウドネイティブなプラットフォーム開発に強く惹かれました。特に、マイクロサービスアーキテクチャとKubernetes環境での開発経験を活かし、スケーラブルなシステム構築に貢献したいと考えています。",
      self_pr: "技術的な課題解決において、単なる実装だけでなく、アーキテクチャ設計から運用まで一貫して考えることを強みとしています。前職では、モノリシックなシステムをマイクロサービス化するプロジェクトをリードし、デプロイ頻度を週1回から日次に改善しました。"
    })
  },
  
  // 金融業界 - アナリスト
  {
    category: "finance",
    jobType: "analyst",
    name: "金融アナリスト向けテンプレート",
    description: "金融機関のアナリスト、リスク管理、データ分析職向けのテンプレートです。分析力と専門知識を重視した構成になっています。",
    promptTemplate: `あなたは金融業界に精通した職務経歴書作成の専門家です。以下の点を重視して、金融アナリスト向けの職務経歴書を作成してください：

1. **分析スキルの具体化**: 使用したツール（Excel、Python、R、SQL）、分析手法、モデリング経験
2. **金融知識の明示**: 資格（CFA、FRM、証券アナリスト）、専門分野（株式、債券、デリバティブ）
3. **定量的な成果**: 運用成績、予測精度、コスト削減額などの数値を含める
4. **リスク管理能力**: リスク評価、ストレステスト、コンプライアンス対応の経験
5. **レポーティング能力**: 経営層への報告、プレゼンテーション、レポート作成の実績

職務経歴書: {{resumeText}}
求人情報: {{jobDescription}}`,
    sampleContent: JSON.stringify({
      summary: "7年以上の金融データ分析経験を持つクオンツアナリスト。Python/Rを用いたリスクモデル開発により、ポートフォリオのシャープレシオを0.8から1.2に改善。CFA Level II保有。機関投資家向けレポート作成とプレゼンテーション経験豊富。",
      motivation: "貴社のクオンツ運用部門において、機械学習を活用した新しい投資戦略の開発に携わりたいと考えています。特に、オルタナティブデータの活用とESG投資への関心が高く、これまでの経験を活かして貢献できると確信しています。",
      self_pr: "データドリブンな意思決定を重視し、複雑な金融データから実用的なインサイトを導き出すことを得意としています。前職では、独自のボラティリティ予測モデルを開発し、トレーディング戦略の改善に貢献しました。"
    })
  },
  
  // 製造業 - マネージャー
  {
    category: "manufacturing",
    jobType: "manager",
    name: "製造業マネージャー向けテンプレート",
    description: "製造業の生産管理、品質管理、プロジェクトマネージャー向けのテンプレートです。マネジメント能力と改善実績を重視した構成になっています。",
    promptTemplate: `あなたは製造業に精通した職務経歴書作成の専門家です。以下の点を重視して、製造業マネージャー向けの職務経歴書を作成してください：

1. **マネジメント実績**: チームサイズ、予算規模、プロジェクト期間などを具体的に記載
2. **生産性向上**: リードタイム短縮、歩留まり改善、コスト削減などの定量的な成果
3. **品質管理**: ISO認証、QC活動、不良率削減などの実績
4. **改善活動**: カイゼン、5S、リーン生産方式などの導入経験
5. **クロスファンクショナル**: 設計、調達、営業など他部門との連携経験

職務経歴書: {{resumeText}}
求人情報: {{jobDescription}}`,
    sampleContent: JSON.stringify({
      summary: "10年以上の製造業経験を持つ生産管理マネージャー。30名のチームを統括し、リーン生産方式の導入によりリードタイムを40%短縮、在庫コストを年間5,000万円削減。ISO9001内部監査員資格保有。",
      motivation: "貴社のグローバル生産体制の最適化プロジェクトに強く惹かれました。これまでの国内外の工場立ち上げ経験と、サプライチェーン改善の実績を活かし、貴社の生産性向上に貢献したいと考えています。",
      self_pr: "現場主義を貫き、データに基づく改善活動を推進することを強みとしています。前職では、IoTセンサーを活用した設備稼働率の可視化により、予防保全を実現し、ダウンタイムを50%削減しました。"
    })
  },
  
  // 営業 - セールス
  {
    category: "sales",
    jobType: "sales",
    name: "営業職向けテンプレート",
    description: "法人営業、個人営業、営業企画職向けのテンプレートです。営業実績と顧客関係構築能力を重視した構成になっています。",
    promptTemplate: `あなたは営業職に精通した職務経歴書作成の専門家です。以下の点を重視して、営業職向けの職務経歴書を作成してください：

1. **営業実績の定量化**: 売上高、達成率、新規顧客獲得数、契約件数などの具体的な数値
2. **顧客関係構築**: 大口顧客の開拓、長期的な信頼関係の構築事例
3. **提案力**: 課題解決型営業、コンサルティング営業の経験
4. **交渉力**: 大型案件の受注、価格交渉、契約条件の調整実績
5. **チームワーク**: 社内連携、部門横断プロジェクト、後輩育成の経験

職務経歴書: {{resumeText}}
求人情報: {{jobDescription}}`,
    sampleContent: JSON.stringify({
      summary: "8年以上のB2B営業経験を持つトップセールス。年間売上目標を5年連続で120%以上達成。大手企業への新規開拓により、年間3億円の売上を創出。顧客満足度調査で常に上位5%にランクイン。",
      motivation: "貴社のSaaS製品の営業職に強く惹かれました。特に、エンタープライズ向けの大型案件開拓において、これまでの法人営業経験とソリューション提案力を活かし、貴社の事業拡大に貢献したいと考えています。",
      self_pr: "顧客の潜在的なニーズを引き出し、最適なソリューションを提案することを得意としています。前職では、顧客の業務フローを詳細にヒアリングし、カスタマイズ提案により競合他社からの切り替えを実現しました。"
    })
  },
  
  // マーケティング - マーケター
  {
    category: "marketing",
    jobType: "marketer",
    name: "マーケター向けテンプレート",
    description: "デジタルマーケティング、ブランドマーケティング、マーケティング企画職向けのテンプレートです。施策実績とデータ分析能力を重視した構成になっています。",
    promptTemplate: `あなたはマーケティング職に精通した職務経歴書作成の専門家です。以下の点を重視して、マーケター向けの職務経歴書を作成してください：

1. **施策実績の定量化**: CV数、CVR、CPA、ROAS、売上貢献額などの具体的な数値
2. **デジタルマーケティングスキル**: SEO、SEM、SNS広告、MA、アナリティクスツールの使用経験
3. **データ分析力**: A/Bテスト、ユーザー行動分析、市場調査の実績
4. **クリエイティブ**: コンテンツ企画、コピーライティング、クリエイティブディレクションの経験
5. **戦略立案**: マーケティング戦略、ブランド戦略、グロースハック施策の立案実績

職務経歴書: {{resumeText}}
求人情報: {{jobDescription}}`,
    sampleContent: JSON.stringify({
      summary: "6年以上のデジタルマーケティング経験を持つグロースマーケター。SEO/SEM施策によりオーガニック流入を年間150%増加、CV数を200%改善。Google Analytics、Google Ads、HubSpot等のツールを駆使したデータドリブンなマーケティングを実践。",
      motivation: "貴社のD2Cブランドのグロース戦略に強く惹かれました。特に、データ分析に基づくPDCAサイクルの高速化と、SNSマーケティングの知見を活かし、貴社の事業成長に貢献したいと考えています。",
      self_pr: "仮説検証を繰り返し、データに基づいて施策を最適化することを得意としています。前職では、LPのA/Bテストを100回以上実施し、CVRを3.5%から7.2%に改善しました。"
    })
  }
];

try {
  for (const template of templates) {
    await connection.execute(
      `INSERT INTO templates (category, jobType, name, description, promptTemplate, sampleContent) 
       VALUES (?, ?, ?, ?, ?, ?)`,
      [
        template.category,
        template.jobType,
        template.name,
        template.description,
        template.promptTemplate,
        template.sampleContent
      ]
    );
    console.log(`✓ Seeded template: ${template.name}`);
  }
  
  console.log("✓ All templates seeded successfully");
} catch (error) {
  console.error("Error seeding templates:", error);
  process.exit(1);
}

await connection.end();
console.log("Seeding completed");
